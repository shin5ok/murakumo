#!/usr/bin/env perl
use strict;
use warnings;
use LWP::Simple;
use JSON;
# use Data::Dumper;
use Text::ASCIITable;

print list();

sub list {
  my $content = get 'http://192.168.232.29:3000/vps/list/';
  my $data = decode_json $content;
  my @rows;
  for my $x ( @{$data->{root}} ) {
    push @rows, 
      [
        $x->{name},
        $x->{uuid},
        $x->{node_uuid},
        $x->{cpu},
        $x->{memory},
        $x->{regist_time},
        $x->{state},
      ];
  }
  my $t = Text::ASCIITable->new;
  $t->setCols('name','uuid','node uuid', 'cpu','memory', 'update time', 'state');
  for (sort { $a->[0] cmp $b->[0] } @rows) {
    $t->addRow($_);
  }
  return $t;
}


__END__
my @rows = (
    [1,'foo','2011-03-16 11:22:33'],
    [2,'hogehogehoge','2011-03-17 11:22:33'],
    [3,'uwaaaaa','2011-03-18 11:22:33'],
    [4,'dio','2011-03-19 11:22:33'],
    [5,'jojo','2011-03-20 11:22:33'],
);

my $t = Text::ASCIITable->new();
$t->setCols('id','name','created');
$t->addRow($_) for @rows;
